# Generated by OmopViewer 0.4.0
# Be careful editing this file

ui <- bslib::page_navbar(
  title = shiny::tags$span(
    shiny::tags$img(
      src = "ohdsi_logo.svg",
      width = "auto",
      height = "46px",
      class = "me-3",
      alt = "logo"
    ),
    "PregnantVaccineSafety"
  ),
  theme = bslib::bs_theme(bootswatch = "flatly"),
  bslib::nav_panel(
    title = "Background",
    icon = shiny::icon("book-atlas"),
    backgroundCard("background.md")
  ),
  bslib::nav_panel(
    title = "Data Snapshot",
    icon = shiny::icon("clipboard-list"),
    bslib::card_header(
      bslib::popover(
        shiny::icon("download"),
        shinyWidgets::pickerInput(
          inputId = "summarise_omop_snapshot_table_format",
          label = "Format",
          choices = c("docx", "png", "pdf", "html"),
          selected = "docx",
          multiple = FALSE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shiny::downloadButton(outputId = "summarise_omop_snapshot_table_download", label = "Download table")
      ),
      class = "text-end"
    ),
    gt::gt_output("summarise_omop_snapshot_table") |>
      shinycssloaders::withSpinner()
  ),
  # Cohort summary ----
  bslib::nav_menu(
    title = "Cohort summary",
    icon = shiny::icon("list"),
    bslib::nav_panel(
      title = "Cohort Count",
      icon = shiny::icon("users"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "summarise_cohort_count_cdm_name",
            label = "CDM name",
            choices = choices$summarise_cohort_count_cdm_name,
            selected = selected$summarise_cohort_count_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_cohort_count_cohort_name",
            label = "Cohort name",
            choices = choices$summarise_cohort_count_cohort_name,
            selected = selected$summarise_cohort_count_cohort_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_cohort_count_variable_name",
            label = "Variable name",
            choices = choices$summarise_cohort_count_variable_name,
            selected = selected$summarise_cohort_count_variable_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_cohort_count_table_name",
            label = "Table name",
            choices = choices$summarise_cohort_count_table_name,
            selected = selected$summarise_cohort_count_table_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_summarise_cohort_count",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_summarise_cohort_count"), class = "ov_update_button"),
        bslib::navset_card_tab(
          bslib::nav_panel(
            title = "Table Counts",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_count_table_format",
                    label = "Format",
                    choices = c("docx", "png", "pdf", "html"),
                    selected = "docx",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::downloadButton(outputId = "summarise_cohort_count_table_download", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  sortable::bucket_list(
                    header = NULL,
                    sortable::add_rank_list(
                      text = "None",
                      labels = c("variable_name", "estimate_name"),
                      input_id = "summarise_cohort_count_table_none"
                    ),
                    sortable::add_rank_list(
                      text = "Header",
                      labels = "cohort_name",
                      input_id = "summarise_cohort_count_table_header"
                    ),
                    sortable::add_rank_list(
                      text = "Group columns",
                      labels = "cdm_name",
                      input_id = "summarise_cohort_count_table_group_column"
                    ),
                    sortable::add_rank_list(
                      text = "Hide",
                      labels = c("variable_level", "table_name", "weighting"),
                      input_id = "summarise_cohort_count_table_hide"
                    )
                  ),
                  position = "right"
                ),
                gt::gt_output("summarise_cohort_count_table") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Plot Counts",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::numericInput(
                    inputId = "summarise_cohort_count_plot_width",
                    label = "Width",
                    value = 15
                  ),
                  shiny::numericInput(
                    inputId = "summarise_cohort_count_plot_height",
                    label = "Height",
                    value = 15
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_count_plot_units",
                    label = "Units",
                    choices = c("px", "cm", "inch"),
                    selected = "cm",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::numericInput(
                    inputId = "summarise_cohort_count_plot_dpi",
                    label = "DPI",
                    value = 300
                  ),
                  shiny::downloadButton(outputId = "summarise_cohort_count_plot_download", label = "Download plot")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  shinyWidgets::materialSwitch(
                    inputId = "summarise_cohort_count_plot_interactive",
                    label = "Interactive",
                    value = TRUE
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_count_plot_facet",
                    label = "Facet",
                    choices = c("cdm_name", "cohort_name", "table_name", "weighting"),
                    selected = "cdm_name",
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_count_plot_colour",
                    label = "Colour",
                    choices = c("cdm_name", "cohort_name", "table_name", "weighting"),
                    selected = "cohort_name",
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                shiny::uiOutput("summarise_cohort_count_plot") |>
                  shinycssloaders::withSpinner()
              )
            )
          )
        )
      )
    ),
    # Cohort attrition ----
    bslib::nav_panel(
      title = "Cohort Attrition",
      icon = shiny::icon("layer-group"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "summarise_cohort_attrition_cdm_name",
            label = "CDM name",
            choices = choices$summarise_cohort_attrition_cdm_name,
            selected = selected$summarise_cohort_attrition_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_cohort_attrition_cohort_name",
            label = "Cohort name",
            choices = choices$summarise_cohort_attrition_cohort_name,
            selected = selected$summarise_cohort_attrition_cohort_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_cohort_attrition_variable_name",
            label = "Variable name",
            choices = choices$summarise_cohort_attrition_variable_name,
            selected = selected$summarise_cohort_attrition_variable_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_summarise_cohort_attrition",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_summarise_cohort_attrition"), class = "ov_update_button"),
        bslib::navset_card_tab(
          bslib::nav_panel(
            title = "Table Attrition",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_attrition_table_format",
                    label = "Format",
                    choices = c("docx", "png", "pdf", "html"),
                    selected = "docx",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::downloadButton(outputId = "summarise_cohort_attrition_table_download", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  sortable::bucket_list(
                    header = NULL,
                    sortable::add_rank_list(
                      text = "None",
                      labels = "reason",
                      input_id = "summarise_cohort_attrition_table_none"
                    ),
                    sortable::add_rank_list(
                      text = "Header",
                      labels = "variable_name",
                      input_id = "summarise_cohort_attrition_table_header"
                    ),
                    sortable::add_rank_list(
                      text = "Group columns",
                      labels = c("cdm_name", "cohort_name"),
                      input_id = "summarise_cohort_attrition_table_group_column"
                    ),
                    sortable::add_rank_list(
                      text = "Hide",
                      labels = c("variable_level", "reason_id", "estimate_name", "cohort_definition_id", "sex", "table_name", "weighting"),
                      input_id = "summarise_cohort_attrition_table_hide"
                    )
                  ),
                  position = "right"
                ),
                gt::gt_output("summarise_cohort_attrition_table") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Diagram",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::numericInput(
                    inputId = "summarise_cohort_attrition_diagram_width",
                    label = "Width (px)",
                    value = 2000
                  ),
                  shiny::downloadButton(outputId = "summarise_cohort_attrition_diagram_download", label = "Download Diagram")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_attrition_diagram_show",
                    label = "Show",
                    choices = c("subjects", "records"),
                    selected = c("subjects", "records"),
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                DiagrammeR::grVizOutput("summarise_cohort_attrition_diagram") |>
                  shinycssloaders::withSpinner()
              )
            )
          )
        )
      )
    )
  ),
  bslib::nav_menu(
    title = "Population",
    icon = shiny::icon("list"),
    # Population ----
    bslib::nav_panel(
      title = "Population",
      icon = shiny::icon("person-pregnant"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "summarise_sampling_cdm_name",
            label = "CDM name",
            choices = choices$summarise_sampling_cdm_name,
            selected = selected$summarise_sampling_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_sampling_cohort_name",
            label = "Cohort",
            choices = paste0("population_objective_", 1:3),
            selected = paste0("population_objective_", 1:3),
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_summarise_sampling",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_summarise_sampling"), class = "ov_update_button"),
        bslib::navset_card_tab(
          bslib::nav_panel(
            title = "Population Counts",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_count_table_format_pop",
                    label = "Format",
                    choices = c("docx", "png", "pdf", "html"),
                    selected = "docx",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::downloadButton(outputId = "summarise_cohort_count_table_download_pop", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  div(
                    style = "margin-left: 20px;",
                    shinyWidgets::pickerInput(
                      inputId = "summarise_cohort_count_exposure_pop",
                      label = "Exposure",
                      choices = choices$summarise_characteristics_exposure,
                      selected = c("comparator", "exposed"),
                      multiple = TRUE,
                      options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                    ),
                    shinyWidgets::pickerInput(
                      inputId = "summarise_cohort_count_vaccine_brand_pop",
                      label = "Vaccine brand",
                      choices = choices$summarise_characteristics_vaccine_brand,
                      selected = "overall",
                      multiple = TRUE,
                      options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                    ),
                    shinyWidgets::pickerInput(
                      inputId = "summarise_cohort_count_gestational_trimester_pop",
                      label = "Gestational trimester",
                      choices = choices$summarise_characteristics_gestational_trimester,
                      selected = "overall",
                      multiple = TRUE,
                      options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                    ),
                    shinyWidgets::pickerInput(
                      inputId = "summarise_cohort_count_age_group_pop",
                      label = "Age group",
                      choices = choices$summarise_characteristics_age_group,
                      selected = "overall",
                      multiple = TRUE,
                      options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                    )
                  ),
                  sortable::bucket_list(
                    header = "Table formatting",
                    sortable::add_rank_list(
                      text = "None",
                      labels = c("variable_name", "estimate_name"),
                      input_id = "summarise_cohort_count_table_none_pop"
                    ),
                    sortable::add_rank_list(
                      text = "Header",
                      labels = c("cdm_name", "exposure"),
                      input_id = "summarise_cohort_count_table_header_pop"
                    ),
                    sortable::add_rank_list(
                      text = "Group columns",
                      labels = "cohort_name",
                      input_id = "summarise_cohort_count_table_group_column_pop"
                    ),
                    sortable::add_rank_list(
                      text = "Hide",
                      labels = c("vaccine_brand", "age_group", "gestational_trimester", "variable_level", "table_name", "weighting"),
                      input_id = "summarise_cohort_count_table_hide_pop"
                    )
                  ),
                  position = "right"
                ),
                gt::gt_output("summarise_cohort_count_table_pop") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Population Table Attrition",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_attrition_table_format_pop",
                    label = "Format",
                    choices = c("docx", "png", "pdf", "html"),
                    selected = "docx",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::downloadButton(outputId = "summarise_cohort_attrition_table_download_pop", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_attrition_variable_name_pop",
                    label = "Variable name",
                    choices = choices$summarise_cohort_attrition_variable_name,
                    selected = selected$summarise_cohort_attrition_variable_name,
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  sortable::bucket_list(
                    header = NULL,
                    sortable::add_rank_list(
                      text = "None",
                      labels = "reason",
                      input_id = "summarise_cohort_attrition_table_none_pop"
                    ),
                    sortable::add_rank_list(
                      text = "Header",
                      labels = "variable_name",
                      input_id = "summarise_cohort_attrition_table_header_pop"
                    ),
                    sortable::add_rank_list(
                      text = "Group columns",
                      labels = c("cdm_name", "cohort_name"),
                      input_id = "summarise_cohort_attrition_table_group_column_pop"
                    ),
                    sortable::add_rank_list(
                      text = "Hide",
                      labels = c("variable_level", "reason_id", "estimate_name", "cohort_definition_id", "sex", "table_name", "weighting"),
                      input_id = "summarise_cohort_attrition_table_hide_pop"
                    )
                  ),
                  position = "right"
                ),
                gt::gt_output("summarise_cohort_attrition_table_pop") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Population Attrition Diagram",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::numericInput(
                    inputId = "summarise_cohort_attrition_diagram_width_pop",
                    label = "Width (px)",
                    value = 2000
                  ),
                  shiny::downloadButton(outputId = "summarise_cohort_attrition_diagram_download_pop", label = "Download Diagram")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  shinyWidgets::pickerInput(
                    inputId = "summarise_cohort_attrition_diagram_show_pop",
                    label = "Show",
                    choices = c("subjects", "records"),
                    selected = c("records"),
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                DiagrammeR::grVizOutput("summarise_cohort_attrition_diagram_pop") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Sampling Summary Table",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_sampling_table_format",
                    label = "Format",
                    choices = c("docx", "png", "pdf", "html"),
                    selected = "docx",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::downloadButton(outputId = "summarise_sampling_table_download", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  sortable::bucket_list(
                    header = NULL,
                    sortable::add_rank_list(
                      text = "None",
                      labels = c("variable_level"),
                      input_id = "summarise_sampling_table_none"
                    ),
                    sortable::add_rank_list(
                      text = "Header",
                      labels = c("variable_name", "estimate_name"),
                      input_id = "summarise_sampling_table_header"
                    ),
                    sortable::add_rank_list(
                      text = "Group columns",
                      labels = c("cdm_name", "cohort_name"),
                      input_id = "summarise_sampling_table_group_column"
                    ),
                    sortable::add_rank_list(
                      text = "Hide",
                      labels = character(),
                      input_id = "summarise_sampling_table_hide"
                    )
                  ),
                  position = "right"
                ),
                gt::gt_output("summarise_sampling_table") |>
                  shinycssloaders::withSpinner()
              )
            )
          )
        )
      )
    ),
    # Propensity Scores (+LASSO) ----
    bslib::nav_panel(
      title = "Propensity scores",
      icon = shiny::icon("gears"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "propensity_scores_cdm_name",
            label = "CDM name",
            choices = choices$propensity_scores_cdm_name,
            selected = selected$propensity_scores_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "propensity_scores_cohort_name",
            label = "Cohort name",
            choices = choices$propensity_scores_cohort_name,
            selected = selected$propensity_scores_cohort_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_propensity_scores",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_propensity_scores"), class = "ov_update_button"),
        bslib::navset_card_tab(
          bslib::nav_panel(
            title = "Model Coefficients",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::downloadButton(outputId = "propensity_score_coeficcients_tidy_download", label = "Download csv")
                ),
                class = "text-end"
              ),
              DT::DTOutput("propensity_score_coeficcients_tidy") |>
                shinycssloaders::withSpinner()
            )
          ),
          bslib::nav_panel(
            title = "Plot Propensity Score",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::numericInput(
                    inputId = "propensity_score_plot_width",
                    label = "Width",
                    value = 15
                  ),
                  shiny::numericInput(
                    inputId = "propensity_score_plot_height",
                    label = "Height",
                    value = 15
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "propensity_score_plot_units",
                    label = "Units",
                    choices = c("px", "cm", "inch"),
                    selected = "cm",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::numericInput(
                    inputId = "propensity_score_plot_dpi",
                    label = "DPI",
                    value = 300
                  ),
                  shiny::downloadButton(outputId = "propensity_score_plot_download", label = "Download plot")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  shinyWidgets::materialSwitch(
                    inputId = "propensity_score_plot_interactive",
                    label = "Interactive",
                    value = TRUE
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "propensity_score_plot_facet",
                    label = "Facet",
                    choices = c("cdm_name", "cohort_name", "vaccine_brand", "gestational_trimester", "age_group"),
                    selected = c("cdm_name", "cohort_name"),
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                shiny::uiOutput("propensity_score_plot") |>
                  shinycssloaders::withSpinner()
              )
            )
          )
        )
      )
    ),
    # Censoring ----
    bslib::nav_panel(
      title = "Cohort exit",
      icon = shiny::icon("right-from-bracket"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_cdm_name",
            label = "CDM name",
            choices = choices$cohort_exit_cdm_name,
            selected = selected$cohort_exit_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_cohort_name",
            label = "Cohort name",
            choices = choices$cohort_exit_cohort_name,
            selected = selected$cohort_exit_cohort_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_exposure",
            label = "Exposure",
            choices = choices$cohort_exit_exposure,
            selected = selected$cohort_exit_exposure,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_vaccine_brand",
            label = "Vaccine brand",
            choices = choices$cohort_exit_vaccine_brand,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_gestational_trimester",
            label = "Gestational trimester",
            choices = choices$cohort_exit_gestational_trimester,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_age_group",
            label = "Age group",
            choices = choices$cohort_exit_age_group,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_exit_reason",
            label = "Exit reason",
            choices = choices$cohort_exit_exit_reason,
            selected = selected$cohort_exit_exit_reason,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_analysis",
            label = "Analysis",
            choices = choices$cohort_exit_analysis,
            selected = "main",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_variable_name",
            label = "Variable name",
            choices = choices$cohort_exit_variable_name,
            selected = selected$cohort_exit_variable_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_estimate_name",
            label = "Estimate name",
            choices = choices$cohort_exit_estimate_name,
            selected = selected$cohort_exit_estimate_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "cohort_exit_weighting",
            label = "Weighting",
            choices = choices$cohort_exit_weighting,
            selected = TRUE,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_cohort_exit",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_cohort_exit"), class = "ov_update_button"),
        bslib::nav_panel(
          title = "Table",
          bslib::card(
            full_screen = TRUE,
            bslib::card_header(
              bslib::popover(
                shiny::icon("download"),
                shinyWidgets::pickerInput(
                  inputId = "cohort_exit_table_format",
                  label = "Format",
                  choices = c("docx", "png", "pdf", "html"),
                  selected = "docx",
                  multiple = FALSE,
                  options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                ),
                shiny::downloadButton(outputId = "cohort_exit_table_download", label = "Download table")
              ),
              class = "text-end"
            ),
            bslib::layout_sidebar(
              sidebar = bslib::sidebar(
                sortable::bucket_list(
                  header = NULL,
                  sortable::add_rank_list(
                    text = "None",
                    labels = c( "exit_reason", "variable_name", "variable_level", "estimate_name"),
                    input_id = "cohort_exit_table_none"
                  ),
                  sortable::add_rank_list(
                    text = "Header",
                    labels = "exposure",
                    input_id = "cohort_exit_table_header"
                  ),
                  sortable::add_rank_list(
                    text = "Group columns",
                    labels = c("cdm_name", "cohort_name"),
                    input_id = "cohort_exit_table_group_column"
                  ),
                  sortable::add_rank_list(
                    text = "Hide",
                    labels = c("vaccine_brand", "gestational_trimester", "age_group", "analysis", "weighting"),
                    input_id = "cohort_exit_table_hide"
                  )
                ),
                position = "right"
              ),
              gt::gt_output("cohort_exit_table") |>
                shinycssloaders::withSpinner()
            )
          )
        )
      )
    ),
    # Cohort characteristics ----
    bslib::nav_panel(
      title = "Cohort Characteristics",
      icon = shiny::icon("users-gear"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_cdm_name",
            label = "CDM name",
            choices = choices$summarise_characteristics_cdm_name,
            selected = selected$summarise_characteristics_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_cohort_name",
            label = "Cohort name",
            choices = choices$summarise_characteristics_cohort_name,
            selected = "population_objective_1",
            multiple = FALSE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_exposure",
            label = "Exposure",
            choices = choices$summarise_characteristics_exposure,
            selected = c("exposed", "comparator"),
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_vaccine_brand",
            label = "Vaccine brand",
            choices = choices$summarise_characteristics_vaccine_brand,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_gestational_trimester",
            label = "Gestational trimester",
            choices = choices$summarise_characteristics_gestational_trimester,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_age_group",
            label = "Age group",
            choices = choices$summarise_characteristics_age_group,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_variable_name",
            label = "Variable name",
            choices = choices$summarise_characteristics_variable_name,
            selected = selected$summarise_characteristics_variable_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_estimate_name",
            label = "Estimate name",
            choices = choices$summarise_characteristics_estimate_name,
            selected = selected$summarise_characteristics_estimate_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_characteristics_weighting",
            label = "Weighting",
            choices = c(TRUE, FALSE),
            selected = TRUE,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_summarise_characteristics",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_summarise_characteristics"), class = "ov_update_button"),
        bslib::navset_card_tab(
          bslib::nav_panel(
            title = "Table Characteristics",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_characteristics_table_format",
                    label = "Format",
                    choices = c("docx", "png", "pdf", "html"),
                    selected = "docx",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::downloadButton(outputId = "summarise_characteristics_table_download", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  sortable::bucket_list(
                    header = NULL,
                    sortable::add_rank_list(
                      text = "None",
                      labels = c("variable_name", "variable_level", "estimate_name"),
                      input_id = "summarise_characteristics_table_none"
                    ),
                    sortable::add_rank_list(
                      text = "Header",
                      labels = c("cdm_name", "exposure"),
                      input_id = "summarise_characteristics_table_header"
                    ),
                    sortable::add_rank_list(
                      text = "Group columns",
                      labels = c("cohort_name"),
                      input_id = "summarise_characteristics_table_group_column"
                    ),
                    sortable::add_rank_list(
                      text = "Hide",
                      labels = c("table_name", "vaccine_brand", "gestational_trimester", "age_group", "weighting"),
                      input_id = "summarise_characteristics_table_hide"
                    )
                  ),
                  position = "right"
                ),
                gt::gt_output("summarise_characteristics_table") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Plot Characteristics",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::numericInput(
                    inputId = "summarise_characteristics_plot_width",
                    label = "Width",
                    value = 15
                  ),
                  shiny::numericInput(
                    inputId = "summarise_characteristics_plot_height",
                    label = "Height",
                    value = 15
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_characteristics_plot_units",
                    label = "Units",
                    choices = c("px", "cm", "inch"),
                    selected = "cm",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::numericInput(
                    inputId = "summarise_characteristics_plot_dpi",
                    label = "DPI",
                    value = 300
                  ),
                  shiny::downloadButton(outputId = "summarise_characteristics_plot_download", label = "Download plot")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  shinyWidgets::materialSwitch(
                    inputId = "summarise_characteristics_plot_interactive",
                    label = "Interactive",
                    value = TRUE
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_characteristics_plot_plot_type",
                    label = "Plot type",
                    choices = c("boxplot", "barplot", "scatterplot"),
                    selected = "boxplot",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_characteristics_plot_facet",
                    label = "Facet",
                    choices = c("cdm_name", "cohort_name", "exposure", "vaccine_brand", "gestational_trimester", "age_group"),
                    selected = "cdm_name",
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_characteristics_plot_colour",
                    label = "Colour",
                    choices = c("cdm_name", "cohort_name", "exposure", "vaccine_brand", "gestational_trimester", "age_group"),
                    selected = "cohort_name",
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                shiny::uiOutput("summarise_characteristics_plot") |>
                  shinycssloaders::withSpinner()
              )
            )
          )
        )
      )
    ),
    # Large Scale Characteristics ----
    bslib::nav_panel(
      title = "Large Scale Characteristics",
      icon = shiny::icon("arrow-up-right-dots"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "summarise_large_scale_characteristics_cdm_name",
            label = "CDM name",
            choices = choices$summarise_large_scale_characteristics_cdm_name,
            selected = selected$summarise_large_scale_characteristics_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_large_scale_characteristics_cohort_name",
            label = "Cohort name",
            choices = choices$summarise_large_scale_characteristics_cohort_name,
            selected = "population_objective_1",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_large_scale_characteristics_exposure",
            label = "Exposure",
            choices = choices$summarise_large_scale_characteristics_exposure,
            selected = c("comparator", "exposed"),
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_large_scale_characteristics_vaccine_brand",
            label = "Vaccine brand",
            choices = choices$summarise_large_scale_characteristics_vaccine_brand,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_large_scale_characteristics_gestational_trimester",
            label = "Gestational trimester",
            choices = choices$summarise_large_scale_characteristics_gestational_trimester,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_large_scale_characteristics_age_group",
            label = "Age group",
            choices = choices$summarise_large_scale_characteristics_age_group,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_large_scale_characteristics_variable_level",
            label = "Variable level",
            choices = choices$summarise_large_scale_characteristics_variable_level,
            selected = selected$summarise_large_scale_characteristics_variable_level,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "summarise_large_scale_characteristics_weighting",
            label = "Weighting",
            choices = choices$summarise_large_scale_characteristics_weighting,
            selected = "TRUE",
            multiple = FALSE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_summarise_large_scale_characteristics",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_summarise_large_scale_characteristics"), class = "ov_update_button"),
        bslib::navset_card_tab(
          bslib::nav_panel(
            title = "Table",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::downloadButton(outputId = "summarise_large_scale_characteristics_table_lsc_download", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  shinyWidgets::pickerInput(
                    inputId = "summarise_large_scale_characteristics_table_lsc_hide",
                    label = "Hide",
                    choices = c("cdm_name", "cohort_name", "type", "exposure", "vaccine_brand", "gestational_trimester", "age_group", "variable_level", "weighting"),
                    selected = c("type", "exposure", "vaccine_brand", "gestational_trimester", "age_group"),
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                reactable::reactableOutput("summarise_large_scale_characteristics_table_lsc") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Plot Compared",
            bslib::card(
              full_screen = TRUE,
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  # shiny.fluent::Toggle.shinyInput(
                  #   label = "Missing data",
                  #   onText = "Interpolate 0",
                  #   offText = "Eliminate",
                  #   value = TRUE,
                  #   inputId = "summarise_large_scale_characteristics_plot_compared_missings"
                  # ),
                  # shinyWidgets::pickerInput(
                  #   inputId = "summarise_large_scale_characteristics_plot_compared_colour",
                  #   label = "Colour",
                  #   choices = c("cdm_name", "cohort_name", "exposure", "vaccine_brand", "gestational_trimester", "age_group", "type", "variable_level"),
                  #   selected = NULL,
                  #   multiple = FALSE,
                  #   options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  # ),
                  # shinyWidgets::pickerInput(
                  #   inputId = "summarise_large_scale_characteristics_plot_compared_reference",
                  #   label = "Reference",
                  #   choices = NULL,
                  #   selected = NULL,
                  #   multiple = FALSE,
                  #   options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  # ),
                  shinyWidgets::pickerInput(
                    inputId = "summarise_large_scale_characteristics_plot_compared_facet",
                    label = "Facet",
                    choices = c("cdm_name", "cohort_name", "vaccine_brand", "gestational_trimester", "age_group", "variable_level"),
                    selected = c("cdm_name", "cohort_name"),
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                plotly::plotlyOutput("summarise_large_scale_characteristics_plot_compared") |>
                  shinycssloaders::withSpinner()
              )
            )
          )
        )
      )
    ),
    # Time 0 distributions ----
    bslib::nav_panel(
      title = "Time 0 distributions",
      icon = shiny::icon("calendar-days"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "gestational_time_distributions_cdm_name",
            label = "CDM name",
            choices = choices$gestational_time_distributions_cdm_name,
            selected = selected$gestational_time_distributions_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "gestational_time_distributions_cohort_name",
            label = "Cohort name",
            choices = choices$gestational_time_distributions_cohort_name,
            selected = selected$gestational_time_distributions_cohort_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "gestational_time_distributions_exposure",
            label = "Exposure",
            choices = choices$gestational_time_distributions_exposure,
            selected = selected$gestational_time_distributions_exposure,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "gestational_time_distributions_vaccine_brand",
            label = "Vaccine brand",
            choices = choices$gestational_time_distributions_vaccine_brand,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "gestational_time_distributions_gestational_trimester",
            label = "Gestational trimester",
            choices = choices$gestational_time_distributions_gestational_trimester,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "gestational_time_distributions_age_group",
            label = "Age group",
            choices = choices$gestational_time_distributions_age_group,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "gestational_time_distributions_weighting",
            label = "Weighting",
            choices = choices$gestational_time_distributions_weighting,
            selected = TRUE,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_gestational_time_distributions",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_gestational_time_distributions"), class = "ov_update_button"),
        bslib::navset_card_tab(
          bslib::nav_panel(
            title = "Plot",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::numericInput(
                    inputId = "gestational_time_distributions_plot_width",
                    label = "Width",
                    value = 15
                  ),
                  shiny::numericInput(
                    inputId = "gestational_time_distributions_plot_height",
                    label = "Height",
                    value = 15
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "gestational_time_distributions_plot_units",
                    label = "Units",
                    choices = c("px", "cm", "inch"),
                    selected = "cm",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::numericInput(
                    inputId = "gestational_time_distributions_plot_dpi",
                    label = "DPI",
                    value = 300
                  ),
                  shiny::downloadButton(outputId = "gestational_time_distributions_plot_download", label = "Download plot")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                fill = TRUE,
                sidebar = bslib::sidebar(
                  shiny::radioButtons(
                    inputId = "gestational_time_distributions_plot_type",
                    label = "Variable",
                    choices = c("gestational_age", "calendar_time"),
                    selected = "gestational_age",
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "gestational_time_distributions_plot_facet",
                    label = "Facet",
                    choices = c("cdm_name", "cohort_name", "exposure", "vaccine_brand", "gestational_trimester", "age_group", "weighting"),
                    selected = c("cdm_name", "cohort_name") ,
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "gestational_time_distributions_plot_colour",
                    label = "Colour",
                    choices = c("cdm_name", "cohort_name", "exposure", "vaccine_brand", "gestational_trimester", "age_group", "weighting"),
                    selected = "exposure",
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                div(
                  style = "height: 100%;",
                  shiny::plotOutput("gestational_time_distributions_plot", height = "500px") |>
                    shinycssloaders::withSpinner()
                )
              )
            )
          )
        )
      )
    ),
    # NCO ----
    bslib::nav_panel(
      title = "Negative control outcomes",
      icon = shiny::icon("chart-bar"),
      bslib::layout_sidebar(
        sidebar = bslib::sidebar(
          shinyWidgets::pickerInput(
            inputId = "negative_control_outcomes_cdm_name",
            label = "CDM name",
            choices = choices$negative_control_outcomes_cdm_name,
            selected = selected$negative_control_outcomes_cdm_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "negative_control_outcomes_cohort_name",
            label = "Cohort name",
            choices = choices$negative_control_outcomes_cohort_name,
            selected = selected$negative_control_outcomes_cohort_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "negative_control_outcomes_vaccine_brand",
            label = "Vaccine brand",
            choices = choices$negative_control_outcomes_vaccine_brand,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "negative_control_outcomes_gestational_trimester",
            label = "Gestational trimester",
            choices = choices$negative_control_outcomes_gestational_trimester,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "negative_control_outcomes_age_group",
            label = "Age group",
            choices = choices$negative_control_outcomes_age_group,
            selected = "overall",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "negative_control_outcomes_outcome_name",
            label = "Outcome name",
            choices = choices$negative_control_outcomes_outcome_name,
            selected = selected$negative_control_outcomes_outcome_name,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "negative_control_outcomes_follow_up_end",
            label = "Follow up end",
            choices = choices$negative_control_outcomes_follow_up_end,
            selected = "cohort_end_date",
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          shinyWidgets::pickerInput(
            inputId = "negative_control_outcomes_weighting",
            label = "Weighting",
            choices = choices$negative_control_outcomes_weighting,
            selected = TRUE,
            multiple = TRUE,
            options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
          ),
          position = "left"
        ),
        shiny::actionButton(
          inputId = "update_negative_control_outcomes",
          label = "Update content",
          width = "200px"
        ),
        shiny::div(shiny::textOutput(outputId = "update_message_negative_control_outcomes"), class = "ov_update_button"),
        bslib::navset_card_tab(
          bslib::nav_panel(
            title = "Summary",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shinyWidgets::pickerInput(
                    inputId = "negative_control_outcomes_table_format_summary",
                    label = "Format",
                    choices = c("docx", "png", "pdf", "html"),
                    selected = "docx",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::downloadButton(outputId = "negative_control_outcomes_table_download_summary", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  sortable::bucket_list(
                    header = NULL,
                    sortable::add_rank_list(
                      text = "None",
                      labels = c("outcome_name", "variable_name", "estimate_name"),
                      input_id = "negative_control_outcomes_table_none_summary"
                    ),
                    sortable::add_rank_list(
                      text = "Header",
                      labels = c("cdm_name", "variable_level"),
                      input_id = "negative_control_outcomes_table_header_summary"
                    ),
                    sortable::add_rank_list(
                      text = "Group columns",
                      labels = c("cohort_name"),
                      input_id = "negative_control_outcomes_table_group_column_summary"
                    ),
                    sortable::add_rank_list(
                      text = "Hide",
                      labels = c("vaccine_brand", "gestational_trimester", "age_group", "outcome_group", "follow_up_end", "weighting"),
                      input_id = "negative_control_outcomes_table_hide_summary"
                    )
                  ),
                  position = "right"
                ),
                gt::gt_output("negative_control_outcomes_table_summary") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Incidence Rate Ratio Table",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shinyWidgets::pickerInput(
                    inputId = "negative_control_outcomes_table_format_irr",
                    label = "Format",
                    choices = c("docx", "png", "pdf", "html"),
                    selected = "docx",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::downloadButton(outputId = "negative_control_outcomes_table_download_irr", label = "Download table")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                sidebar = bslib::sidebar(
                  sortable::bucket_list(
                    header = NULL,
                    sortable::add_rank_list(
                      text = "None",
                      labels = c("outcome_name"),
                      input_id = "negative_control_outcomes_table_none_irr"
                    ),
                    sortable::add_rank_list(
                      text = "Header",
                      labels = c("cdm_name", "estimate_name"),
                      input_id = "negative_control_outcomes_table_header_irr"
                    ),
                    sortable::add_rank_list(
                      text = "Group columns",
                      labels = c("cohort_name"),
                      input_id = "negative_control_outcomes_table_group_column_irr"
                    ),
                    sortable::add_rank_list(
                      text = "Hide",
                      labels = c("vaccine_brand", "gestational_trimester", "age_group", "outcome_group", "follow_up_end", "weighting", "variable_name", "variable_level"),
                      input_id = "negative_control_outcomes_table_hide_irr"
                    )
                  ),
                  position = "right"
                ),
                gt::gt_output("negative_control_outcomes_table_irr") |>
                  shinycssloaders::withSpinner()
              )
            )
          ),
          bslib::nav_panel(
            title = "Incidence Rate Ratio Plot",
            bslib::card(
              full_screen = TRUE,
              bslib::card_header(
                bslib::popover(
                  shiny::icon("download"),
                  shiny::numericInput(
                    inputId = "negative_control_outcomes_plot_width",
                    label = "Width",
                    value = 15
                  ),
                  shiny::numericInput(
                    inputId = "negative_control_outcomes_plot_height",
                    label = "Height",
                    value = 15
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "negative_control_outcomes_plot_units",
                    label = "Units",
                    choices = c("px", "cm", "inch"),
                    selected = "cm",
                    multiple = FALSE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shiny::numericInput(
                    inputId = "negative_control_outcomes_plot_dpi",
                    label = "DPI",
                    value = 300
                  ),
                  shiny::downloadButton(outputId = "negative_control_outcomes_plot_download", label = "Download plot")
                ),
                class = "text-end"
              ),
              bslib::layout_sidebar(
                fill = TRUE,
                sidebar = bslib::sidebar(
                  #   shiny::radioButtons(
                  #     inputId = "negative_control_outcomes_plot_type",
                  #     label = "Plot type",
                  #     choices = c("Forest plot", "Fuunel plot"),
                  #     selected = "Forest plot",
                  #   ),
                  shinyWidgets::pickerInput(
                    inputId = "negative_control_outcomes_plot_y",
                    label = "Vertical component",
                    choices = c("cdm_name", "cohort_name", "vaccine_brand", "gestational_trimester", "age_group", "weighting", "outcome_name", "follow_up_end"),
                    selected = "outcome_name",
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "negative_control_outcomes_plot_facet",
                    label = "Facet",
                    choices = c("cdm_name", "cohort_name", "vaccine_brand", "gestational_trimester", "age_group", "weighting", "outcome_name", "follow_up_end"),
                    selected = "cdm_name",
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  shinyWidgets::pickerInput(
                    inputId = "negative_control_outcomes_plot_colour",
                    label = "Colour",
                    choices = c("cdm_name", "cohort_name", "vaccine_brand", "gestational_trimester", "age_group", "weighting", "outcome_name", "follow_up_end"),
                    selected = "cohort_name",
                    multiple = TRUE,
                    options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                  ),
                  position = "right"
                ),
                div(
                  style = "height: 100%;",
                  shiny::plotOutput("negative_control_outcomes_plot", height = "800px") |>
                    shinycssloaders::withSpinner()
                )
              )
            )
          )
        )
      )
    )
  ),
  # IRR ----
  bslib::nav_panel(
    title = "Incidence Rate Ratios",
    icon = shiny::icon("chart-bar"),
    bslib::layout_sidebar(
      sidebar = bslib::sidebar(
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_cdm_name",
          label = "CDM name",
          choices = choices$incidence_rate_ratio_cdm_name,
          selected = selected$incidence_rate_ratio_cdm_name,
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_cohort_name",
          label = "Cohort name",
          choices = choices$incidence_rate_ratio_cohort_name,
          selected = selected$incidence_rate_ratio_cohort_name,
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_vaccine_brand",
          label = "Vaccine brand",
          choices = choices$incidence_rate_ratio_vaccine_brand,
          selected = "overall",
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_gestational_trimester",
          label = "Gestational trimester",
          choices = choices$incidence_rate_ratio_gestational_trimester,
          selected = "overall",
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_age_group",
          label = "Age group",
          choices = choices$incidence_rate_ratio_age_group,
          selected = "overall",
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_outcome_group",
          label = "Outcome group",
          choices = choices$incidence_rate_ratio_outcome_group,
          selected = "Adverse Events of Special Interest",
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_outcome_name",
          label = "Outcome name",
          choices = choices$incidence_rate_ratio_outcome_name,
          selected = selected$incidence_rate_ratio_outcome_name,
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_follow_up_end",
          label = "Follow up end",
          choices = choices$incidence_rate_ratio_follow_up_end,
          selected = "end_42_days_or_pregnancy",
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        shinyWidgets::pickerInput(
          inputId = "incidence_rate_ratio_weighting",
          label = "Weighting",
          choices = choices$incidence_rate_ratio_weighting,
          selected = TRUE,
          multiple = TRUE,
          options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
        ),
        position = "left"
      ),
      shiny::actionButton(
        inputId = "update_incidence_rate_ratio",
        label = "Update content",
        width = "200px"
      ),
      shiny::div(shiny::textOutput(outputId = "update_message_incidence_rate_ratio"), class = "ov_update_button"),
      bslib::navset_card_tab(
        bslib::nav_panel(
          title = "Summary",
          bslib::card(
            full_screen = TRUE,
            bslib::card_header(
              bslib::popover(
                shiny::icon("download"),
                shinyWidgets::pickerInput(
                  inputId = "incidence_rate_ratio_table_format_summary",
                  label = "Format",
                  choices = c("docx", "png", "pdf", "html"),
                  selected = "docx",
                  multiple = FALSE,
                  options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                ),
                shiny::downloadButton(outputId = "incidence_rate_ratio_table_download_summary", label = "Download table")
              ),
              class = "text-end"
            ),
            bslib::layout_sidebar(
              sidebar = bslib::sidebar(
                sortable::bucket_list(
                  header = NULL,
                  sortable::add_rank_list(
                    text = "None",
                    labels = c("outcome_name", "variable_name", "estimate_name"),
                    input_id = "incidence_rate_ratio_table_none_summary"
                  ),
                  sortable::add_rank_list(
                    text = "Header",
                    labels = c("cdm_name", "variable_level"),
                    input_id = "incidence_rate_ratio_table_header_summary"
                  ),
                  sortable::add_rank_list(
                    text = "Group columns",
                    labels = c("cohort_name"),
                    input_id = "incidence_rate_ratio_table_group_column_summary"
                  ),
                  sortable::add_rank_list(
                    text = "Hide",
                    labels = c("vaccine_brand", "gestational_trimester", "age_group", "outcome_group", "follow_up_end", "weighting"),
                    input_id = "incidence_rate_ratio_table_hide_summary"
                  )
                ),
                position = "right"
              ),
              gt::gt_output("incidence_rate_ratio_table_summary") |>
                shinycssloaders::withSpinner()
            )
          )
        ),
        bslib::nav_panel(
          title = "Incidence Rate Ratio Table",
          bslib::card(
            full_screen = TRUE,
            bslib::card_header(
              bslib::popover(
                shiny::icon("download"),
                shinyWidgets::pickerInput(
                  inputId = "incidence_rate_ratio_table_format_irr",
                  label = "Format",
                  choices = c("docx", "png", "pdf", "html"),
                  selected = "docx",
                  multiple = FALSE,
                  options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                ),
                shiny::downloadButton(outputId = "incidence_rate_ratio_table_download_irr", label = "Download table")
              ),
              class = "text-end"
            ),
            bslib::layout_sidebar(
              sidebar = bslib::sidebar(
                sortable::bucket_list(
                  header = NULL,
                  sortable::add_rank_list(
                    text = "None",
                    labels = c("outcome_name"),
                    input_id = "incidence_rate_ratio_table_none_irr"
                  ),
                  sortable::add_rank_list(
                    text = "Header",
                    labels = c("cdm_name", "estimate_name"),
                    input_id = "incidence_rate_ratio_table_header_irr"
                  ),
                  sortable::add_rank_list(
                    text = "Group columns",
                    labels = c("cohort_name"),
                    input_id = "incidence_rate_ratio_table_group_column_irr"
                  ),
                  sortable::add_rank_list(
                    text = "Hide",
                    labels = c("vaccine_brand", "gestational_trimester", "age_group", "outcome_group", "follow_up_end", "weighting", "variable_name", "variable_level"),
                    input_id = "incidence_rate_ratio_table_hide_irr"
                  )
                ),
                position = "right"
              ),
              gt::gt_output("incidence_rate_ratio_table_irr") |>
                shinycssloaders::withSpinner()
            )
          )
        ),
        bslib::nav_panel(
          title = "Incidence Rate Ratio Plot",
          bslib::card(
            full_screen = TRUE,
            bslib::card_header(
              bslib::popover(
                shiny::icon("download"),
                shiny::numericInput(
                  inputId = "incidence_rate_ratio_plot_width",
                  label = "Width",
                  value = 15
                ),
                shiny::numericInput(
                  inputId = "incidence_rate_ratio_plot_height",
                  label = "Height",
                  value = 15
                ),
                shinyWidgets::pickerInput(
                  inputId = "incidence_rate_ratio_plot_units",
                  label = "Units",
                  choices = c("px", "cm", "inch"),
                  selected = "cm",
                  multiple = FALSE,
                  options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                ),
                shiny::numericInput(
                  inputId = "incidence_rate_ratio_plot_dpi",
                  label = "DPI",
                  value = 300
                ),
                shiny::downloadButton(outputId = "incidence_rate_ratio_plot_download", label = "Download plot")
              ),
              class = "text-end"
            ),
            bslib::layout_sidebar(
              fill = TRUE,
              sidebar = bslib::sidebar(
                shinyWidgets::pickerInput(
                  inputId = "incidence_rate_ratio_plot_y",
                  label = "Vertical component",
                  choices = c("cdm_name", "cohort_name", "vaccine_brand", "gestational_trimester", "age_group", "weighting", "outcome_name", "follow_up_end"),
                  selected = "outcome_name",
                  multiple = TRUE,
                  options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                ),
                shinyWidgets::pickerInput(
                  inputId = "incidence_rate_ratio_plot_facet",
                  label = "Facet",
                  choices = c("cdm_name", "cohort_name", "vaccine_brand", "gestational_trimester", "age_group", "weighting", "outcome_name", "follow_up_end"),
                  selected = "cdm_name",
                  multiple = TRUE,
                  options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                ),
                shinyWidgets::pickerInput(
                  inputId = "incidence_rate_ratio_plot_colour",
                  label = "Colour",
                  choices = c("cdm_name", "cohort_name", "vaccine_brand", "gestational_trimester", "age_group", "weighting", "outcome_name", "follow_up_end"),
                  selected = "cohort_name",
                  multiple = TRUE,
                  options = list(`actions-box` = TRUE, size = 10, `selected-text-format` = "count > 3")
                ),
                position = "right"
              ),
              div(
                style = "height: 100%;",
                shiny::plotOutput("incidence_rate_ratio_plot", height = "800px") |>
                  shinycssloaders::withSpinner()
              )
            )
          )
        )
      )
    )
  ),
  bslib::nav_spacer(),
  bslib::nav_item(
    bslib::popover(
      shiny::icon("download"),
      shiny::downloadButton(
        outputId = "download_raw",
        label = "Download raw data",
        icon = shiny::icon("download")
      )
    )
  ),
  bslib::nav_item(
    bslib::popover(
      shiny::icon("circle-info"),
      shiny::tags$img(
        src = "hds_logo.svg",
        class = "logo-img",
        alt = "Logo",
        height = "auto",
        width = "30%",
        style = "float:right"
      ),
      "This shiny app was generated with ",
      shiny::a(
        "OmopViewer",
        href = "https://github.com/OHDSI/OmopViewer",
        target = "_blank"
      ),
      shiny::strong("v0.4.0")
    )
  ),
  bslib::nav_item(bslib::input_dark_mode(id = "dark_mode", mode = "light"))
)
